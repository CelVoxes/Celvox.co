---
title: "debug"
author: "EOK"
date: "2024-10-16"
output: html_document
---

```{r}
library(FNN)

# Set the working directory to the backend folder
setwd("backend")

# Verify the working directory has been changed
cat("Current working directory:", getwd(), "\n")

# Optionally, list files in the new working directory to confirm
cat("Files in the current directory:\n")
print(list.files())

source("plumber.R")
```

```{r}
corrected <- readRDS("backend/cache/normalized_and_corrected_matrix.rds")
# selected most variable 2000 genes
vars <- apply(corrected, 1, var)
corrected_2000 <- corrected[names(vars[order(vars, decreasing = T)[1:2000]]), ]
```


```{r}
library(FNN)

knn_result <- FNN::get.knn(corrected_2000, k = 10)

knn_indices <- knn_result$nn.index
knn_distances <- knn_result$nn.dist

knn_df <- data.frame(
    sample_id = colnames(corrected_2000),
    knn_indices = knn_indices,
    knn_distances = knn_distances
)
```
```{r}
library(data.table)
    uncorrected <- fread("backend/data/counts/uncorrected_counts.csv", data.table = F)
    sample_data <- readRDS("backend/cache/sample_data.rds")
```


```{r}
library(seAMLess)
library(Biobase)
seAMLess(sample_data)
```
```{r}

gene_index =2
norm.mat <-fread("/Users/onur-lumc/Desktop/seamless/backend/data/counts/normalised_and_corrected_counts.csv", 
                   select = c(1, gene_index + 1),  # +1 because the first column is gene names
                       data.table = FALSE)

    # Read only the sample IDs and the requested gene column
    gene_data <- fread("/Users/onur-lumc/Desktop/seamless/backend/data/counts/normalised_and_corrected_counts.csv", 
                       select = c(1, gene_index),
                       col.names = c("sample_id", "expression"),
                       data.table = FALSE)

norm.mat <-fread("/Users/onur-lumc/Desktop/seamless/backend/data/counts/normalised_and_corrected_counts.csv", data.table = FALSE)

norm.mat2 <- readRDS("/Users/onur-lumc/Desktop/seamless/backend/cache/normalized_and_corrected_matrix.rds")
```
```{r}
norm.fst <- read_fst('backend/cache/normalized_and_corrected_matrix.fst')

write_fst(norm.fst, path = "/Users/onur-lumc/Desktop/data.fst")\


tsne_df <- read_fst("backend/cache/tsne_result.fst")

 rownames(tsne_df) <- tsne_df[, 1]
tsne_df <- tsne_df[, -1, drop = FALSE]
```

```{r}

example.tcga <- read.csv("/Users/onur-lumc/Desktop/exampleTCGA.csv")
```
```{r}
library(fst)

sample.fst <-read_fst("backend/cache/sample_data.fst")

sample.fst <- sample.fst[!grepl("__no_feature|__ambiguous", rownames(sample.fst)), ]
```

